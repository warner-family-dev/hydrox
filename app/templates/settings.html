{% extends "base.html" %}
{% block content %}
<section class="hero">
  <div>
    <h1>Settings</h1>
    <p class="lead">Rename fan channels before applying profiles. Defaults mirror the OCTO labels.</p>
  </div>
</section>

<section class="panel">
  <div class="panel__header">
    <h2>Fan Channels</h2>
    <span class="panel__tag">Rename</span>
  </div>
  <form class="settings-count" method="post" action="/settings/fan-count">
    <label class="form__label">Active fan count</label>
    <div class="settings-count__row">
      <input class="form__input" type="number" name="fan_count" min="1" max="16" value="{{ fan_count }}" required />
      <button class="button button--ghost" type="submit">Update Count</button>
    </div>
  </form>
  <form class="settings-calibrate" method="post" action="/settings/fans/calibrate">
    <div class="settings-calibrate__body">
      <div class="settings-calibrate__title">Calibrate fan max RPM</div>
      <div class="settings-calibrate__note">Sets all fans to 100%, waits 15 seconds, reads RPM, then restores the active profile or 20%.</div>
    </div>
    <button class="button" type="submit">Calibrate</button>
  </form>
  <div class="settings-list">
    {% for fan in fans %}
    <form class="settings-row" method="post" action="/settings/fans">
      <input type="hidden" name="fan_id" value="{{ fan.id }}" />
      <div class="settings-row__label">Channel {{ fan.channel_index }}</div>
      <div class="settings-row__meta">
        Default: {{ fan.default_name }}
        {% if fan.active == 0 %}
        <span class="settings-row__inactive">Inactive</span>
        {% endif %}
      </div>
      <input class="form__input" type="text" name="name" value="{{ fan.name }}" required />
      <input class="form__input" type="number" name="max_rpm" value="{{ fan.max_rpm or '' }}" min="0" placeholder="Max RPM" />
      <button class="button button--ghost" type="submit">Update</button>
    </form>
    {% endfor %}
  </div>
</section>
{% endblock %}
