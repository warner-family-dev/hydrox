services:
  hydrox:
    build: .
    container_name: hydrox
    ports:
      - "8000:8000"
    privileged: true
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - hydrox_data:/data
      - ./.git:/.git:ro
      - ./logs:/logs
      - /proc/net/wireless:/host-proc/net/wireless:ro
      - /run/wpa_supplicant:/host-run/wpa_supplicant:ro
      - /sys/class/net:/host-sys/class/net:ro
      - /sys/bus/w1/devices:/sys/bus/w1/devices:ro
      - /sys/devices/platform/cooling_fan:/sys/devices/platform/cooling_fan:ro
      - /sys/class/hwmon:/sys/class/hwmon:ro
    devices:
      - /dev/bus/usb:/dev/bus/usb
      - /dev/vcio:/dev/vcio
      - /dev/i2c-1:/dev/i2c-1
    environment:
      - HYDROX_DB_PATH=/data/hydrox.db
      - HYDROX_GIT_DIR=/.git
      - HYDROX_LOG_PATH=/logs/hydrox.log
      - HYDROX_WIFI_PROC_PATH=/host-proc/net/wireless
      - HYDROX_WIFI_WPA_PATH=/host-run/wpa_supplicant
      - HYDROX_WIFI_SYS_PATH=/host-sys/class/net
      - HYDROX_WIFI_INTERFACE=wlan0
      - HYDROX_WIFI_EXPORTER_URL=http://host.docker.internal:9100/wifi
      - TZ=America/Chicago
      - PUID=1000
      - PGID=1003

  wifi-exporter:
    build: ./wifi_exporter
    container_name: hydrox-wifi-exporter
    network_mode: host
    cap_add:
      - NET_ADMIN
    environment:
      - WIFI_INTERFACE=wlan0

volumes:
  hydrox_data:
